{% extends 'pharmacy/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block head_block %}
<style>
    #id_from_date,#id_to_date,#id_Store,#id_MRP,#id_Expiry_Date,#id_Pysical_Qty,#id_GST,#id_CGST,#id_SGST,#id_IGST,#id_Remark{
      border: 2px solid rgb(233, 233, 233);
      width: 100%;
      background-color: rgb(233, 233, 233);
      border-bottom: 1px solid black;
    }

    </style>
{% endblock  %}
{% block body_block %}
<!-- content -->
<div class="page-wrapper">
<div class="content">
  <nav class="navbar navbar-light bg-blue" style="background-color: rgb(64, 64, 207);">
   <div class="container-fluid">
       <a class="navbar-brand" style="color: white;" href="#">Stock Entry</a>
   </div>
 </nav><br>
<div class="container-fluid">
   
       <div class="col-lg-12 col-md-12 col-sm-8 col-xs-8">
           <div class="card">
       <div class="body">
        <div class="row clearfix">
            <button type="button" class="btn btn-warning" data-toggle="modal" data-target=".bd-example-modal-xl"><i class="fas fa-plus" >Add</i></button>&nbsp;
            <button type="button" class="btn btn-info"><a href="#"><i class="fas fa-edit"  style="color:white;">Edit</i></a></button>&nbsp;
            <button type="button"class="btn btn-success"> <i class="fas fa-save" >Save</i></button>&nbsp;
            <button type="button" class="btn btn-primary"  onClick="window.location.reload();"> <i class="fas fa-sync-alt" >Refresh</i></button>&nbsp;
            <a href="" class="btn btn-danger"> <i class="fas fa-times-circle">Exit</i></a>
        </div>
               <br>
               <div class="col-lg-12 col-md-12 col-sm-4 col-xs-4" style="background-color:rgb(233, 233, 233);"><br>
               
                <form method="POST">
                     {% csrf_token %}
                     <div class="form-row">
                      <div class="form-group col-md-3 mb-0">
                        {{form.item|as_crispy_field}}

                        </div>
                        <div class="form-group col-md-3 mb-0">
                            {{form.from_date|as_crispy_field}}

                        </div>
                        <div class="form-group col-md-3 mb-0">
                            {{form.to_date|as_crispy_field}}

                        </div>
                      <div class="form-group col-md-0"><br>
                        <button type="button" class="btn btn-warning" > <i class="fas fa-search" >Search</i></button>&nbsp;
                      </div>
                     <!-- <button type="button"class="btn btn-success"> <i class="fas fa-save" >Save</i></button>&nbsp;  -->
                    
                    
                 </div>
                 
                   </form>

                </div>
                <div class='container'>
                    <div class="col-lg-16">
                      <fieldset class="border" >
                        <legend class ='text-left' style="color: red;"><b>Stock Entry</b></legend>
                        <div class="col-lg-12 col-md-12 col-sm-4 col-xs-4" style="background-color:rgb(233, 233, 233);"><br>
                          <form method="POST">
                            {% csrf_token %}
                            <div class="row clearfix">
                               <div class="col-md-3">
                                {{form.item|as_crispy_field}}
                               </div>
                               <div class="col-md-2">
                                {{form.Store|as_crispy_field}}
                               </div>
                               <div class="col-md-2">
                                {{form.MRP|as_crispy_field}}
                               </div>
                               <div class="col-md-2" >
                                {{form.Expiry_Date|as_crispy_field}}
                               </div>
                               <div class="col-md-2">
                                {{form.Pysical_Qty|as_crispy_field}}
                               </div>
                               <div class="col-md-2">
                                {{form.GST|as_crispy_field}}
                               </div>
                               <div class="col-md-2">
                                {{form.CGST|as_crispy_field}}
                               </div>
                               <div class="col-md-2">
                                {{form.SGST|as_crispy_field}}
                               </div>
                               <div class="col-md-2">
                                {{form.IGST|as_crispy_field}}
                               </div>
                               <div class="col-md-2">
                                {{form.Remark|as_crispy_field}}
                               </div>
                               <div class="col-md-0"><br>
                               <button type="button" class="btn btn-warning" > <i class="fas fa-edit" >Insert</i></button>&nbsp;
                               </div>
                            </div>
                          </form>
                        </div>
                        
                 
                 
                       
                                   
                      </fieldset>
                    </div>
                </div>
<div class="table-responsive">
    <table class="datatable table table-stripped ">


                   <thead>
                       <tr><th>S.No</th>
                           <th>Item</th>
                           <th>Batch/Serial No.</th>
                           <th>MRP</th>
                           <th>Expiry Date</th>
                           <th>Physical Qty</th>
                           <th>CGST%</th>
                           <th>SGST%</th>
                           <th>IGST</th>
                           <th>Remark</th>

                       </tr>
                   </thead>
                   <tbody>
                       <tr>
                           <td></td>
                           <td></td>
                           <td></td>
                           <td></td>
                           <td></td>
                           <td></td>
                       </tr>
                    </tbody>
           </table>
           </div>
        
  </div>

  {% endblock  %}



  <script type="text/javascript">
    $(document).ready(function () {
    
        $(document).on('keyup', '#rate', function () {
            var rate = this.value;
            var qty = $('#physical_qty').val();
            var amount = qty * rate;
            $('#amount').val(amount);
          });
    
    $('#stock_entry').on('show.bs.modal', function(e) {
    
    var link     = $(e.relatedTarget)
     
      var item_name = link.data("item_name")
      var po_id = link.data("po_id")
      //var po_date = link.data("po_date")
      var item_id = link.data("item_id")
      // var vendor_id = link.data("vendor_id")
      // var net_amt = link.data("net_amt")
      // var basic_amt = link.data("basic_amt")
      // var tax_details = link.data("tax_details")
      // var tax = link.data("tax")
      // var discount_amount = link.data("discount_amount")
      // var item_qty = link.data("item_qty")
      
      var modal    = $(this)
    modal.find(".modal-body #item_name").val(item_name);
    modal.find(".modal-body #po_id").val(po_id);
    //modal.find(".modal-body #po_date").val(po_date);
    modal.find(".modal-body #item_id").val(item_id);
    // modal.find(".modal-body #vendor_id").val(vendor_id);
    // modal.find(".modal-body #net_amt").val(net_amt);
    // modal.find(".modal-body #basic_amt").val(basic_amt);
    // modal.find(".modal-body #tax_details").val(tax_details);
    // modal.find(".modal-body #tax").val(tax);
    // modal.find(".modal-body #discount_amount").val(discount_amount);
    // modal.find(".modal-body #item_qty").val(item_qty);
    
    });     
    
    $('#stock_entry_update').on('show.bs.modal', function(e) {
    
    var link     = $(e.relatedTarget)
     
      var item_name = link.data("item_name")
      var po_id = link.data("po_id")
      var item_id = link.data("item_id")
      var modal    = $(this)
    
                $.ajax({
                    url:"{{url('get_stock_detail')}}",
                    type:"post",
                    data:{
                       po_id: po_id,
                       item_id: item_id,
                       _token: '{{csrf_token()}}'
                     },
                    dataType: 'json',
                    success:function(data)
                    {
                        $('#e_store_id').val(data.store_name);
                        $('#e_serial_batch').val(data.serial_batch);
                        $('#e_invoice_no').val(data.invoice_no);
                        $('#e_mrp').val(data.mrp);
                        $('#e_expiry_date').val(data.expiry_date);
                        $('#e_physical_qty').val(data.physical_qty);
                        $('#e_gst').val(data.gst);
                        $('#e_cgst').val(data.cgst);
                        $('#e_sgst').val(data.sgst);
                        $('#e_igst').val(data.igst);
                        $('#e_remark').val(data.remark);
                    }
                });
        
    modal.find(".modal-body #item_name").val(item_name);
    modal.find(".modal-body #po_id").val(po_id);
    modal.find(".modal-body #item_id").val(item_id);
    
    });     
    });
    </script>  
